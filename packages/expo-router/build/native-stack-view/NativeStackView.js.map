{"version":3,"file":"NativeStackView.js","sourceRoot":"","sources":["../../src/native-stack-view/NativeStackView.tsx"],"names":[],"mappings":"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","sourcesContent":["import { SafeAreaProviderCompat } from '@react-navigation/elements';\nimport { NavigationContext, NavigationRouteContext, StackActions } from '@react-navigation/native';\nimport React, { useMemo } from 'react';\nimport { Stack } from 'react-native-screens/experimental';\n\nimport type { NativeStackOptions } from './types';\nimport type { NativeStackState } from './NativeStackRouter';\n\ntype Descriptor = {\n  options: NativeStackOptions;\n  render: () => React.ReactNode;\n  route: { key: string; name: string };\n  navigation: any;\n};\n\ntype Props = {\n  state: NativeStackState;\n  navigation: any;\n  descriptors: Record<string, Descriptor>;\n};\n\nexport function NativeStackView({ state, navigation, descriptors }: Props) {\n  const cachedDescriptors = useMemo(() => new Map(), []);\n  return (\n    <SafeAreaProviderCompat>\n      <Stack.Host>\n        {state.routes.map((route, index) => {\n          const descriptor = descriptors[route.key] ?? cachedDescriptors.get(route.key);\n\n          if (!descriptor) {\n            throw new Error(`Descriptor not found for route ${route.name} ${route.key}`);\n          }\n\n          return (\n            <NavigationContext.Provider key={route.key} value={descriptor.navigation}>\n              <NavigationRouteContext.Provider value={route}>\n                <Stack.Screen\n                  key={route.key}\n                  screenKey={route.key}\n                  activityMode={!state.poppedRoutes.has(route.key) ? 'attached' : 'detached'}\n                  // Event callbacks\n                  onWillAppear={() => {\n                    console.log('onWillAppear');\n                    navigation.emit({\n                      type: 'transitionStart',\n                      data: { closing: false },\n                      target: route.key,\n                    });\n                  }}\n                  onDidAppear={() => {\n                    console.log('onDidAppear');\n                    navigation.emit({\n                      type: 'transitionEnd',\n                      data: { closing: false },\n                      target: route.key,\n                    });\n                  }}\n                  onWillDisappear={() => {\n                    console.log('onWillDisappear');\n                    navigation.emit({\n                      type: 'transitionStart',\n                      data: { closing: true },\n                      target: route.key,\n                    });\n                    cachedDescriptors.set(route.key, descriptor);\n                  }}\n                  onDidDisappear={() => {\n                    console.log('onDidDisappear');\n                    navigation.emit({\n                      type: 'transitionEnd',\n                      data: { closing: true },\n                      target: route.key,\n                    });\n                  }}\n                  onDismiss={() => {\n                    console.log('dismissing');\n                    navigation.dispatch({\n                      ...StackActions.pop(),\n                      source: route.key,\n                      target: state.key,\n                    });\n                  }}\n                  onNativeDismiss={() => {\n                    console.log('dismissing');\n                    navigation.dispatch({\n                      ...StackActions.pop(),\n                      source: route.key,\n                      target: state.key,\n                    });\n                  }}>\n                  {descriptor.render()}\n                </Stack.Screen>\n              </NavigationRouteContext.Provider>\n            </NavigationContext.Provider>\n          );\n        })}\n      </Stack.Host>\n    </SafeAreaProviderCompat>\n  );\n}\n"]}