{"version":3,"file":"usePreventZoomTransitionDismissal.ios.js","sourceRoot":"","sources":["../../../src/link/zoom/usePreventZoomTransitionDismissal.ios.tsx"],"names":[],"mappings":"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","sourcesContent":["'use client';\n\nimport { useRoute } from '@react-navigation/native';\nimport { use } from 'react';\n\nimport type { UsePreventZoomTransitionDismissalOptions } from './usePreventZoomTransitionDismissal.types';\nimport { ZoomTransitionTargetContext } from './zoom-transition-context';\nimport { DescriptorsContext } from '../../fork/native-stack/descriptors-context';\nimport { INTERNAL_EXPO_ROUTER_GESTURE_ENABLED_OPTION_NAME } from '../../navigationParams';\nimport { useNavigation } from '../../useNavigation';\nimport { isRoutePreloadedInStack } from '../../utils/stack';\nimport { isModalPresentation } from '../../utils/stackPresentation';\nimport { useSafeLayoutEffect } from '../../views/useSafeLayoutEffect';\nimport { useIsPreview } from '../preview/PreviewRouteContext';\n\nexport function usePreventZoomTransitionDismissal(\n  options?: UsePreventZoomTransitionDismissalOptions\n) {\n  const context = use(ZoomTransitionTargetContext);\n  const route = useRoute();\n  const navigation = useNavigation();\n  const isPreview = useIsPreview();\n  const isFocused = navigation.isFocused();\n  const isPreloaded = isPreview ? false : isRoutePreloadedInStack(navigation.getState(), route);\n\n  const descriptorsMap = use(DescriptorsContext);\n  const currentDescriptor = descriptorsMap[route.key];\n  const gestureEnabled = currentDescriptor?.options?.gestureEnabled;\n  const isModal = isModalPresentation(currentDescriptor?.options);\n\n  useSafeLayoutEffect(() => {\n    if (isPreview) return;\n    if (isModal) {\n      console.warn(\n        '[expo-router] usePreventZoomTransitionDismissal has no effect on screens presented modally. Please remove this hook from the screen component or change the screen presentation to a non-modal style.'\n      );\n      return;\n    }\n    if (!context.hasEnabler) {\n      return;\n    }\n    const rect = options?.unstable_dismissalBoundsRect;\n\n    // Validate rect if provided\n    if (rect) {\n      const { minX, maxX, minY, maxY } = rect;\n\n      // Validate that max > min when both are defined\n      if (minX !== undefined && maxX !== undefined && minX >= maxX) {\n        console.warn('[expo-router] unstable_dismissalBoundsRect: minX must be less than maxX');\n        return;\n      }\n      if (minY !== undefined && maxY !== undefined && minY >= maxY) {\n        console.warn('[expo-router] unstable_dismissalBoundsRect: minY must be less than maxY');\n        return;\n      }\n    }\n\n    // Determine the final rect to use for dismissal bounds:\n    // 1. If user provided a rect, use it\n    // 2. If user disabled gestures entirely (gestureEnabled={false}), block the whole screen\n    //    by setting impossible bounds { maxX: 0, maxY: 0 }\n    // 3. Otherwise, allow normal dismissal (null rect)\n    const computedRect = rect ?? (gestureEnabled === false ? { maxX: 0, maxY: 0 } : null);\n\n    context.setDismissalBoundsRect?.(computedRect);\n\n    if (!isPreloaded || (isPreloaded && isFocused)) {\n      // Disable React Navigation's gesture handler when we have custom bounds to prevent conflicts.\n      // The native zoom transition's interactiveDismissShouldBegin callback handles dismissal instead.\n      // We use the internal option to preserve the user's gestureEnabled setting.\n      navigation.setOptions({\n        [INTERNAL_EXPO_ROUTER_GESTURE_ENABLED_OPTION_NAME]: computedRect ? false : undefined,\n      });\n    }\n\n    // Cleanup on unmount\n    return () => {\n      context.setDismissalBoundsRect?.(null);\n    };\n  }, [\n    options?.unstable_dismissalBoundsRect?.minX,\n    options?.unstable_dismissalBoundsRect?.maxX,\n    options?.unstable_dismissalBoundsRect?.minY,\n    options?.unstable_dismissalBoundsRect?.maxY,\n    context.setDismissalBoundsRect,\n    gestureEnabled,\n    navigation,\n    isFocused,\n    isPreloaded,\n    isModal,\n    isPreview,\n  ]);\n}\n"]}