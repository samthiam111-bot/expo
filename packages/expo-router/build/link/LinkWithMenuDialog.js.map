{"version":3,"file":"LinkWithMenuDialog.js","sourceRoot":"","sources":["../../src/link/LinkWithMenuDialog.tsx"],"names":[],"mappings":"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","sourcesContent":["'use client';\n\nimport React, { Children, isValidElement, useMemo, useState, type ReactElement } from 'react';\nimport { Modal, Pressable, StyleSheet, Text, View, type GestureResponderEvent } from 'react-native';\n\nimport { BaseExpoRouterLink } from './BaseExpoRouterLink';\nimport {\n  LinkMenu,\n  LinkMenuAction,\n  LinkTrigger,\n  type LinkMenuActionProps,\n  type LinkMenuProps,\n} from './elements';\nimport type { LinkProps } from './useLinkHooks';\nimport { getAllChildrenNotOfType, getFirstChildOfType } from '../utils/children';\n\nfunction extractActions(menuElement: ReactElement<LinkMenuProps>): LinkMenuActionProps[] {\n  const actions: LinkMenuActionProps[] = [];\n  Children.toArray(menuElement.props.children).forEach((child) => {\n    if (isValidElement(child) && child.type === LinkMenuAction) {\n      const props = child.props as LinkMenuActionProps;\n      if (!props.hidden) {\n        actions.push(props);\n      }\n    }\n    // Skip LinkMenu children (nested submenus) â€” only collect flat actions\n  });\n  return actions;\n}\n\nfunction getActionLabel(action: LinkMenuActionProps): string | undefined {\n  if (typeof action.children === 'string') {\n    return action.children;\n  }\n  return action.title;\n}\n\nexport function LinkWithMenuDialog({ children, onLongPress, ...rest }: LinkProps) {\n  const [isModalVisible, setIsModalVisible] = useState(false);\n\n  const triggerElement = useMemo(() => getFirstChildOfType(children, LinkTrigger), [children]);\n  const menuElement = useMemo(\n    () => getFirstChildOfType(children, LinkMenu) as ReactElement<LinkMenuProps> | undefined,\n    [children]\n  );\n\n  const trigger = useMemo(\n    () => triggerElement ?? getAllChildrenNotOfType(children, LinkMenu),\n    [triggerElement, children]\n  );\n  const actions = useMemo(() => (menuElement ? extractActions(menuElement) : []), [menuElement]);\n  const menuTitle = menuElement?.props.title;\n\n  const handleLongPress = (e: GestureResponderEvent) => {\n    if (actions.length > 0) {\n      setIsModalVisible(true);\n    }\n    onLongPress?.(e);\n  };\n\n  return (\n    <>\n      <BaseExpoRouterLink {...rest} onLongPress={handleLongPress} children={trigger} />\n      <Modal\n        visible={isModalVisible}\n        transparent\n        statusBarTranslucent\n        animationType=\"fade\"\n        onRequestClose={() => setIsModalVisible(false)}>\n        <Pressable\n          testID=\"menu-dialog-backdrop\"\n          style={styles.backdrop}\n          accessibilityRole=\"none\"\n          onPress={() => setIsModalVisible(false)}>\n          {/* onStartShouldSetResponder prevents backdrop onPress when tapping inside the dialog */}\n          <View\n            style={styles.dialog}\n            accessibilityRole=\"menu\"\n            onStartShouldSetResponder={() => true}>\n            {menuTitle ? <Text style={styles.title}>{menuTitle}</Text> : null}\n            {actions.map((action, index) => {\n              const label = getActionLabel(action);\n              return (\n                <Pressable\n                  key={index}\n                  disabled={action.disabled}\n                  accessibilityRole=\"menuitem\"\n                  accessibilityLabel={label}\n                  accessibilityState={{ disabled: action.disabled }}\n                  onPress={() => {\n                    setIsModalVisible(false);\n                    action.onPress?.();\n                  }}\n                  style={({ pressed }) => [styles.actionItem, pressed && styles.actionItemPressed]}>\n                  <Text\n                    style={[\n                      styles.actionText,\n                      action.destructive && styles.destructiveText,\n                      action.disabled && styles.disabledText,\n                    ]}>\n                    {label}\n                  </Text>\n                </Pressable>\n              );\n            })}\n          </View>\n        </Pressable>\n      </Modal>\n    </>\n  );\n}\n\nconst styles = StyleSheet.create({\n  backdrop: {\n    flex: 1,\n    justifyContent: 'center',\n    alignItems: 'center',\n    backgroundColor: 'rgba(0, 0, 0, 0.5)',\n  },\n  dialog: {\n    backgroundColor: '#fff',\n    borderRadius: 16,\n    paddingVertical: 8,\n    minWidth: 240,\n    maxWidth: '80%',\n    elevation: 8,\n  },\n  title: {\n    fontSize: 14,\n    fontWeight: '600',\n    color: '#666',\n    paddingHorizontal: 16,\n    paddingVertical: 10,\n    borderBottomWidth: StyleSheet.hairlineWidth,\n    borderBottomColor: '#e0e0e0',\n  },\n  actionItem: {\n    paddingHorizontal: 16,\n    paddingVertical: 14,\n  },\n  actionItemPressed: {\n    backgroundColor: '#f0f0f0',\n  },\n  actionText: {\n    fontSize: 16,\n    color: '#212121',\n  },\n  destructiveText: {\n    color: '#FF3B30',\n  },\n  disabledText: {\n    opacity: 0.38,\n  },\n});\n"]}