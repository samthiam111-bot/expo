{"version":3,"file":"Widgets.js","sourceRoot":"","sources":["../src/Widgets.ts"],"names":[],"mappings":"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","sourcesContent":["import { type EventSubscription } from 'expo-modules-core';\n\nimport ExpoWidgetsModule from './ExpoWidgets';\nimport type {\n  ExpoWidgetsEvents,\n  LiveActivityComponent,\n  LiveActivityDismissalPolicy,\n  NativeLiveActivity,\n  NativeLiveActivityFactory,\n  NativeWidgetObject,\n  PushTokenEvent,\n  WidgetBase,\n  WidgetTimelineEntry,\n} from './Widgets.types';\n\n/**\n * Represents a widget instance. Provides methods to manage the widget's timeline.\n */\nexport class Widget<T extends object = object> {\n  /** @hidden */\n  private nativeWidgetObject: NativeWidgetObject;\n  constructor(name: string, layout: (p: WidgetBase<T>) => React.JSX.Element) {\n    this.nativeWidgetObject = new ExpoWidgetsModule.Widget(name, layout as unknown as string);\n  }\n\n  /**\n   * Force reloads the widget, causing it to refresh its content and timeline.\n   */\n  reload() {\n    this.nativeWidgetObject.reload();\n  }\n\n  /**\n   * Schedules a series of updates for the widget's content and reloads the widget.\n   * @param entries Timeline entries, each specifying a date and the props to display at that time.\n   */\n  updateTimeline(entries: WidgetTimelineEntry<T>[]) {\n    this.nativeWidgetObject.updateTimeline(\n      entries.map((entry) => ({ timestamp: entry.date.getTime(), props: entry.props }))\n    );\n  }\n\n  /**\n   * Sets the widget's content to the given props immediately, without scheduling a timeline.\n   * @param props The properties to display in the widget.\n   */\n  updateSnapshot(props: T) {\n    this.nativeWidgetObject.updateTimeline([{ timestamp: Date.now(), props }]);\n  }\n\n  /**\n   * Returns the current timeline entries for the widget, including past and future entries.\n   */\n  async getTimeline(): Promise<WidgetTimelineEntry<T>[]> {\n    return (await this.nativeWidgetObject.getTimeline()).map((entry) => ({\n      date: new Date(entry.timestamp),\n      props: entry.props as T,\n    }));\n  }\n}\n\n/**\n * Represents a Live Activity instance. Provides methods to update its content and end it.\n */\nexport class LiveActivity<T extends object = object> {\n  /** @hidden */\n  private nativeLiveActivity: NativeLiveActivity;\n  constructor(nativeLiveActivity: NativeLiveActivity) {\n    this.nativeLiveActivity = nativeLiveActivity;\n  }\n\n  /**\n   * Updates the Live Activity's content. The UI reflects the new properties immediately.\n   * @param props The updated content properties.\n   */\n  update(props: T): Promise<void> {\n    return this.nativeLiveActivity.update(JSON.stringify(props));\n  }\n\n  /**\n   * Ends the Live Activity.\n   * @param dismissalPolicy Controls when the Live Activity is removed from the Lock Screen after ending.\n   */\n  end(dismissalPolicy?: LiveActivityDismissalPolicy): Promise<void> {\n    return this.nativeLiveActivity.end(dismissalPolicy);\n  }\n\n  /**\n   * Returns the push token for this Live Activity, used to send push notification updates via APNs.\n   * Returns `null` if push notifications are not enabled or the token is not yet available.\n   */\n  getPushToken(): Promise<string | null> {\n    return this.nativeLiveActivity.getPushToken();\n  }\n\n  /**\n   * Adds a listener for push token update events on this Live Activity instance.\n   * The token can be used to send content updates to this specific activity via APNs.\n   * @param listener Callback invoked when a new push token is available.\n   * @returns An event subscription that can be used to remove the listener.\n   */\n  addPushTokenListener(listener: (event: PushTokenEvent) => void): EventSubscription {\n    return this.nativeLiveActivity.addListener('onExpoWidgetsTokenReceived', listener);\n  }\n}\n\n/**\n * Manages Live Activity instances of a specific type. Use it to start new activities and retrieve currently active ones.\n */\nexport class LiveActivityFactory<T extends object = object> {\n  /** @hidden */\n  private nativeLiveActivityFactory: NativeLiveActivityFactory;\n  constructor(name: string, layout: LiveActivityComponent<T>) {\n    this.nativeLiveActivityFactory = new ExpoWidgetsModule.LiveActivityFactory(\n      name,\n      layout as unknown as string\n    );\n  }\n\n  /**\n   * Starts a new Live Activity with the given properties.\n   * @param props The initial content properties for the Live Activity.\n   * @param url An optional URL to associate with the Live Activity, used for deep linking.\n   * @returns The new Live Activity instance.\n   */\n  start(props: T, url?: string) {\n    return new LiveActivity<T>(this.nativeLiveActivityFactory.start(JSON.stringify(props), url));\n  }\n\n  /**\n   * Returns all currently active instances of this Live Activity type.\n   */\n  getInstances() {\n    return this.nativeLiveActivityFactory\n      .getInstances()\n      .map((instance) => new LiveActivity<T>(instance));\n  }\n}\n\n/**\n * Creates a Widget instance.\n * @param name The widget name. Must match the `'name'` field in your widget configuration in the app config.\n * @param widget The widget component, marked with the `'widget'` directive.\n */\nexport function createWidget<T extends object = object>(\n  name: string,\n  widget: (props: WidgetBase<T>) => React.JSX.Element\n): Widget<T> {\n  return new Widget<T>(name, widget);\n}\n\n/**\n * Creates a Live Activity Factory for managing Live Activities of a specific type.\n * @param name The Live Activity name. Must match the `'name'` field in your widget configuration in the app config.\n * @param liveActivity The Live Activity component, marked with the `'widget'` directive.\n */\nexport function createLiveActivity<T extends object = object>(\n  name: string,\n  liveActivity: LiveActivityComponent<T>\n): LiveActivityFactory<T> {\n  return new LiveActivityFactory<T>(name, liveActivity);\n}\n\n/**\n * Adds a listener for widget interaction events (for example, button taps).\n * @param listener Callback function to handle user interaction events.\n * @return An event subscription that can be used to remove the listener.\n */\nexport function addUserInteractionListener(\n  listener: ExpoWidgetsEvents['onExpoWidgetsUserInteraction']\n): EventSubscription {\n  return ExpoWidgetsModule.addListener('onExpoWidgetsUserInteraction', listener);\n}\n\n/**\n * Adds a listener for push-to-start token events.\n * This token can be used to start live activities remotely via APNs.\n * @param listener Callback function to handle push-to-start token events.\n * @return An event subscription that can be used to remove the listener.\n */\nexport function addPushToStartTokenListener(\n  listener: ExpoWidgetsEvents['onExpoWidgetsPushToStartTokenReceived']\n): EventSubscription {\n  return ExpoWidgetsModule.addListener('onExpoWidgetsPushToStartTokenReceived', listener);\n}\n"]}