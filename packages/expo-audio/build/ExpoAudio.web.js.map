{"version":3,"file":"ExpoAudio.web.js","sourceRoot":"","sources":["../src/ExpoAudio.web.ts"],"names":[],"mappings":"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","sourcesContent":["import { useEvent } from 'expo';\nimport { PermissionResponse, useReleasingSharedObject } from 'expo-modules-core';\nimport { useEffect, useState, useMemo } from 'react';\n\nimport {\n  AudioMode,\n  AudioPlayerOptions,\n  AudioPlaylistOptions,\n  AudioPlaylistStatus,\n  AudioSource,\n  AudioStatus,\n  PreloadOptions,\n  RecorderState,\n  RecordingOptions,\n  RecordingStatus,\n} from './Audio.types';\nimport {\n  AUDIO_SAMPLE_UPDATE,\n  PLAYBACK_STATUS_UPDATE,\n  PLAYLIST_STATUS_UPDATE,\n  RECORDING_STATUS_UPDATE,\n} from './AudioEventKeys';\nimport { AudioPlayer, AudioRecorder, AudioSample } from './AudioModule.types';\nimport * as AudioModule from './AudioModule.web';\nimport { createRecordingOptions } from './utils/options';\nimport { resolveSource, resolveSources } from './utils/resolveSource';\n\nexport function createAudioPlayer(\n  source: AudioSource | string | number | null = null,\n  options: AudioPlayerOptions = {}\n): AudioPlayer {\n  const { downloadFirst = false } = options;\n\n  // If downloadFirst is true, we don't need to resolve the source, because it will be replaced once the source is downloaded.\n  // If downloadFirst is false, we resolve the source here.\n  const initialSource = downloadFirst ? null : resolveSource(source);\n  const player = new AudioModule.AudioPlayerWeb(initialSource, options);\n\n  // Preload the source and replace the player's source with the cached blob URL.\n  // Only relevant if downloadFirst is true and source is not null.\n  if (downloadFirst && source) {\n    const resolved = resolveSource(source);\n    if (resolved) {\n      AudioModule.preloadAsync(resolved).finally(() => {\n        player.replace(resolved);\n      });\n    }\n  }\n\n  return player;\n}\n\nexport function useAudioPlayer(\n  source: AudioSource | string | number | null = null,\n  options: AudioPlayerOptions = {}\n): AudioModule.AudioPlayerWeb {\n  const { downloadFirst = false } = options;\n\n  // If downloadFirst is true, we don't need to resolve the source, because it will be resolved in the useEffect below.\n  // If downloadFirst is false, we resolve the source here.\n  // we call .replace() in the useEffect below to replace the source with the downloaded one.\n  const initialSource = useMemo(() => {\n    return downloadFirst ? null : resolveSource(source);\n  }, [JSON.stringify(source), downloadFirst]);\n\n  const player = useReleasingSharedObject(\n    () => new AudioModule.AudioPlayerWeb(initialSource, options),\n    [JSON.stringify(initialSource), JSON.stringify(options)]\n  );\n\n  // Handle async source resolution for downloadFirst\n  useEffect(() => {\n    if (!downloadFirst || source === null) {\n      return;\n    }\n\n    let isCancelled = false;\n    const resolved = resolveSource(source);\n\n    if (resolved) {\n      AudioModule.preloadAsync(resolved).finally(() => {\n        if (!isCancelled) {\n          player.replace(resolved);\n        }\n      });\n    }\n\n    return () => {\n      isCancelled = true;\n    };\n  }, [player, JSON.stringify(source), downloadFirst]);\n\n  return player;\n}\n\nexport function useAudioPlayerStatus(player: AudioModule.AudioPlayerWeb): AudioStatus {\n  const currentStatus = useMemo(() => player.currentStatus, [player.id]);\n  return useEvent(player, PLAYBACK_STATUS_UPDATE, currentStatus);\n}\n\nexport function useAudioSampleListener(\n  player: AudioModule.AudioPlayerWeb,\n  listener: (data: AudioSample) => void\n) {\n  player.setAudioSamplingEnabled(true);\n  useEffect(() => {\n    const subscription = player.addListener(AUDIO_SAMPLE_UPDATE, listener);\n    return () => {\n      player.setAudioSamplingEnabled(false);\n      subscription.remove();\n    };\n  }, [player.id]);\n}\n\nexport function useAudioRecorder(\n  options: RecordingOptions,\n  statusListener?: (status: RecordingStatus) => void\n): AudioModule.AudioRecorderWeb {\n  const platformOptions = createRecordingOptions(options);\n  const recorder = useMemo(() => {\n    return new AudioModule.AudioRecorderWeb(platformOptions);\n  }, [JSON.stringify(platformOptions)]);\n\n  useEffect(() => {\n    const subscription = recorder.addListener(RECORDING_STATUS_UPDATE, (status) => {\n      statusListener?.(status);\n    });\n    return () => {\n      recorder.clearTimeouts();\n      subscription.remove();\n    };\n  }, [recorder.id]);\n\n  return recorder;\n}\n\nexport function useAudioRecorderState(recorder: AudioRecorder, interval: number = 500) {\n  const [state, setState] = useState<RecorderState>(recorder.getStatus());\n\n  useEffect(() => {\n    const int = setInterval(() => {\n      const newState = recorder.getStatus();\n\n      setState((prevState) => {\n        const meteringChanged =\n          (prevState.metering === undefined) !== (newState.metering === undefined) ||\n          (prevState.metering !== undefined &&\n            newState.metering !== undefined &&\n            Math.abs(prevState.metering - newState.metering) > 0.1);\n\n        if (\n          prevState.canRecord !== newState.canRecord ||\n          prevState.isRecording !== newState.isRecording ||\n          prevState.mediaServicesDidReset !== newState.mediaServicesDidReset ||\n          prevState.url !== newState.url ||\n          Math.abs(prevState.durationMillis - newState.durationMillis) > 50 ||\n          meteringChanged\n        ) {\n          return newState;\n        }\n        return prevState;\n      });\n    }, interval);\n\n    return () => clearInterval(int);\n  }, [recorder.id]);\n\n  return state;\n}\n\nexport async function setIsAudioActiveAsync(active: boolean): Promise<void> {\n  return await AudioModule.setIsAudioActiveAsync(active);\n}\n\nexport async function setAudioModeAsync(mode: AudioMode): Promise<void> {\n  return await AudioModule.setAudioModeAsync(mode);\n}\n\nexport async function requestRecordingPermissionsAsync(): Promise<PermissionResponse> {\n  return await AudioModule.requestRecordingPermissionsAsync();\n}\n\nexport async function getRecordingPermissionsAsync(): Promise<PermissionResponse> {\n  return await AudioModule.getRecordingPermissionsAsync();\n}\n\nexport function useAudioPlaylist(options: AudioPlaylistOptions = {}): AudioModule.AudioPlaylistWeb {\n  const { sources = [], updateInterval = 500, loop = 'none', crossOrigin } = options;\n\n  const resolvedSources = useMemo(() => resolveSources(sources), [JSON.stringify(sources)]);\n\n  const playlist = useMemo(\n    () => new AudioModule.AudioPlaylistWeb(resolvedSources, updateInterval, loop, crossOrigin),\n    [JSON.stringify(resolvedSources), updateInterval, loop, crossOrigin]\n  );\n\n  useEffect(() => {\n    return () => playlist.destroy();\n  }, [playlist]);\n\n  return playlist;\n}\n\nexport function useAudioPlaylistStatus(\n  playlist: AudioModule.AudioPlaylistWeb\n): AudioPlaylistStatus {\n  const currentStatus = useMemo(() => playlist.currentStatus, [playlist.id]);\n  return useEvent(playlist, PLAYLIST_STATUS_UPDATE, currentStatus);\n}\n\nexport function createAudioPlaylist(\n  options: AudioPlaylistOptions = {}\n): AudioModule.AudioPlaylistWeb {\n  const { sources = [], updateInterval = 500, loop = 'none', crossOrigin } = options;\n  const resolvedSources = resolveSources(sources);\n  return new AudioModule.AudioPlaylistWeb(resolvedSources, updateInterval, loop, crossOrigin);\n}\n\nexport function preload(source: AudioSource, _options: PreloadOptions = {}): void {\n  const resolved = resolveSource(source);\n  if (!resolved) return;\n  AudioModule.preload(resolved);\n}\n\nexport function clearPreloadedSource(source: AudioSource): void {\n  const resolved = resolveSource(source);\n  if (!resolved) return;\n  AudioModule.clearPreloadedSource(resolved);\n}\n\nexport function clearAllPreloadedSources(): void {\n  AudioModule.clearAllPreloadedSources();\n}\n\nexport function getPreloadedSources(): string[] {\n  return AudioModule.getPreloadedSources();\n}\n\nexport { AudioModule };\n"]}